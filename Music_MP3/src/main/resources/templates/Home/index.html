<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scooped -Online Music Player</title>
    <!-- it is connected to two stylesheets -->
    <link rel="stylesheet" type="text/css" href="Stylesheet_main.css"><!-- this is the main stylesheet -->
    <!-- desktop first approach is used for the same. -->
    <link rel="stylesheet" type="text/css" href="primary page responsive.css">
    <!-- this is the style sheet with all the media queries -->
    <!-- this script is just for font awesome fonts -->
    <script src="https://kit.fontawesome.com/2d9b67a497.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>


</head>
<!-- body -->
<style>
    /* Tô màu cho phần đã phát của thanh trượt */
    input[type="range"]::-webkit-slider-runnable-track {
        background: linear-gradient(to right, #3498db 0%, #3498db calc(var(--range-value, 0%)), #ddd calc(var(--range-value, 0%) + 1px), #ddd 100%);
    }

    /* CSS cho các nút sắp xếp */
    button#sort-asc,
    button#sort-desc {
        /* CSS của cả hai nút */
        padding: 10px;
        margin: 5px;
        border: none;
        background-color: #007BFF;
        color: white;
        cursor: pointer;
    }

    button#sort-asc:hover,
    button#sort-desc:hover {
        /* CSS hover của cả hai nút */
        background-color: #0056b3;
    }

    .artist-name,
    .song-views {
        font-size: smaller;
        opacity: 0.6; /* Mờ hơn */
    }
</style>
<body>
<!-- top navigation bar -->
<nav class="navigation-bar" style="padding-top: 20px">
    <!-- this div contains the logo and title os the page -->
    <div class="title-combo">
        <div class="website-logo">
            <img src="media/website_logo.svg">
        </div>
        <div class="website-name">
            <h1>
                Scooped
            </h1>
            <h4>
                Online Music Player
            </h4>
        </div>
    </div>
    <!-- this is for search bar -->
    <div class="search-bar">
        <div>
            <!-- magnifying glass- search icon -->
            <i class="fas fa-search search-ico"></i>
        </div>
        <input type="text" id="search-input" name="search" placeholder="Search">
    </div>

    <!-- this is for notification bell -->

    <!-- this is for profile picture -->
    <div class="profile-picture" id="profile-picture">
        <a href="#">
            <img src="media/profile_picture.svg">
        </a>
    </div>
</nav>
<main>
    <!-- aside section 1 -->
    <aside class="aside section-1">
        <!-- this is for the carousel -->
        <div class="outer-carousel">
            <div class="carousel">
                <!-- these are the 3 images in the carousel -->
                <img src="media/crousel/carousel1.jpg">
                <img src="media/crousel/carousel2.jpg">
                <img src="media/crousel/carousel3.jpg">
            </div>
        </div>
        <!-- this is the latest release section -->
        <div class="latest-release">
            <h1 style="margin-bottom: 12px;">
                Latest Release
            </h1>
            <div>
                <button id="sort-asc">Sort Ascending</button>
                <button id="sort-desc">Sort Descending</button>
            </div>
            <!-- this is the content of the latest release section -->
            <!-- it will contain the "cards" -->
            <div class="latest-release-content" id="song-container">
                <!--                <div id="song-container">-->

                <!--                </div>-->

            </div>
        </div>
        <!-- this is the popular artists section -->
        <div class="popular-artists">
            <!-- this is the heading of popular artists section -->
            <h1 style="margin-bottom: 12px;">
                Popular Artists
            </h1>
            <!-- this contains the content of the popular artists section -->
            <div class="popular-artist-content" id="artist-container">
                <!-- Artists will be dynamically inserted here -->

            </div>
        </div>
        <!-- this is the music themes part, the one with the tri-gradient background -->
        <div class="music-themes">
            <!-- this div will be the logo of music themes, see the output, the one with 3 squares/rects  -->
            <!-- the logo with orange, green and yellow color -->
            <div class="stations">
                <div id="div1">
                    <div id="div2">
                        <div id="div3">
                            <img src="media/website_logo.svg">
                            <p>Stations</p>
                        </div>
                    </div>
                </div>
            </div>
            <!-- this is the content part of them themes -->
            <!-- the one which changes colors on hover -->
            <div class="theme-main">
                <div class="theme-content">
                    <img src="media/music themes/chill.jpg">
                    <p>Chill</p>
                </div>
                <div class="theme-content">
                    <img src="media/music themes/rock.jpg">
                    <p>Rock</p>
                </div>
                <div class="theme-content">
                    <img src="media/music themes/love.jpg">
                    <p>Love</p>
                </div>
                <div class="theme-content">
                    <img src="media/music themes/pop.jpg">
                    <p>Pop</p>
                </div>
                <div class="theme-content">
                    <img src="media/music themes/retro.jpg">
                    <p>Retro</p>
                </div>
                <div class="theme-content">
                    <img src="media/music themes/workout.jpg">
                    <p>Workout</p>
                </div>
            </div>
        </div>
        <!-- this is another themes portion, that electronic, party and road theme -->
        <div class="music-themes-2">
            <!-- 3 divs content -->
            <div class="outer-div">
                <div class="inner-div">
                    <span>party</span>
                </div>
            </div>
            <div class="outer-div">
                <div class="inner-div">
                    <span>Electronic</span>
                </div>
            </div>
            <div class="outer-div">
                <div class="inner-div">
                    <span>Road</span>
                </div>
            </div>
        </div>
        <!-- div over -->
        <!-- this div contains the language section of the page -->
        <!-- "language class is common to both hindi and english sections" -->
        <!-- in this way redundancy is handled. considering the re-usability of the code -->
        <div class="language english">
            <!-- latest english section -->
            <h1 class="language-heading">
                Latest English
            </h1>
            <!-- contents of latest english -->
            <div class="language-content">
                <div>
                    <img src="media/latest english/I'll Wait.jpg">
                    <p>I'll Wait</p>
                    <p>Aug 20, 2020</p>
                </div>
                <div>
                    <img src="media/latest english/let me go.jpg">
                    <p>Let me Go!</p>
                    <p>Aug 20, 2020</p>
                </div>
                <div>
                    <img src="media/latest english/qurantine clean.jpg">
                    <p>Qurantine Clean</p>
                    <p>Aug 20, 2020</p>
                </div>
                <div>
                    <img src="media/latest english/roar.jpg">
                    <p>Roar</p>
                    <p>Aug 20, 2020</p>
                </div>
                <div>
                    <img src="media/latest english/toosie slide.jpg">
                    <p>Toosie Slide</p>
                    <p>Aug 20, 2020</p>
                </div>
                <div>
                    <img src="media/latest english/uptown funk.png">
                    <p>Uptown Funk</p>
                    <p>Aug 20, 2020</p>
                </div>
            </div>
        </div>
        <!-- this is the hindi section -->
        <div class="language hindi">
            <!-- hindi section heading -->
            <h1 class="language-heading">
                Latest Hindi
            </h1>
            <!-- hindi section contents -->
            <div class="language-content">

                <div>
                    <img src="media/latest hindi/baarish.jpeg">
                    <p>Baarish</p>
                    <p>Aug 20, 2020</p>
                </div>
                <div>
                    <img src="media/latest hindi/galiyaan.jpg">
                    <p>Galiyaan</p>
                    <p>Aug 20, 2020</p>
                </div>
                <div>
                    <img src="media/latest hindi/giveme some sunshine.jpg">
                    <p>Give me Some Sunshine</p>
                    <p>Aug 20, 2020</p>
                </div>
                <div>
                    <img src="media/latest hindi/kaun tujhe.jpg">
                    <p>Kaun Tujhe</p>
                    <p>Aug 20, 2020</p>
                </div>
                <div>
                    <img src="media/latest hindi/tera ban jaunga.jpg">
                    <p>Tera Ban Jaunga</p>
                    <p>Aug 20, 2020</p>
                </div>
                <div>
                    <img src="media/latest hindi/tere sang yara.jpg">
                    <p>Tere Sang Yaara</p>
                    <p>Aug 20, 2020</p>
                </div>
            </div>
        </div>
    </aside>
    <!-- one aside section is complete -->
    <!-- now the second aside section will start from here -->
    <!-- the page is responsive. please try reducing the width of the page -->
    <!-- the aside section will collapse and a "more button will be shown to you." -->
    <!-- clicking on this more button, you will be shown the aside section 2  -->
    <!-- its position will be absolute at lower resolutions -->
    <!-- this is the label for that more button -->
    <label for="more"><i class="fas fa-angle-double-left"></i>More</label>
    <!-- this is that more button -->
    <!-- and this is the check box. this will always be hidden -->
    <!-- check the stylesheet_main.css when the label is clicked, this checkbox will be checked -->
    <!-- which will invoke the aside section 2 on lower resolutions -->
    <input type="checkbox" id="more">
    <!-- here starts the section 2 of our page -->
    <aside class="aside section-2">
        <!-- this is the section heading part. the heading will be static -->
        <div class="heading" style="margin-left: 320px">
            <h4>
                <a href="#queue-option-box">Queue <i class="fas fa-chevron-circle-down"></i></a>
            </h4>
        </div>
        <!-- this is the queue box which will be shown when the user clicks on the Queue button -->
        <!-- it will have 3 options, playlists, favourite songs and Close button. it will close when one clicks on the close button. -->
        <div class="queue-options" id="queue-option-box">
            <p><a href style="color:#007bff; font-weight:bolder;">Playlists</a></p>
            <hr>
            <p><a href style="color:#007bff; font-weight:bolder;">Favourite songs</a></p>
            <hr>
            <p><a href="#" style="color:red; font-weight:bolder;">Close</a></p>
        </div>

        <div class="playlist-content">

        </div>

    </aside>
</main>
<!-- main part of the page is over. -->
<!-- this is the footer part. -->
<!-- its position will be fixed to the screen bottom. -->
<footer>
    <div class="active-song-description">
        <div id="song-image">
            <img src="media/latest english/roar.jpg" alt="Current song image">
        </div>
        <div class="song-desc">
            <div>Imagine by John</div>
            <div>John Lennon</div>
        </div>
    </div>
    <div class="player">
        <div class="controls">
            <div id="random-button"><i class="fas fa-random"></i></div>
            <div id="prev-button"><i class="fas fa-step-backward"></i></div>
            <div id="play-pause-button"><i class="fas fa-play-circle"></i></div>
            <div id="next-button"><i class="fas fa-step-forward"></i></div>
            <div id="reset-button"><i class="fas fa-redo"></i></div>
        </div>
        <div id="slider">
            <div class="time">
                <span id="current-time">0:00</span>
            </div>
            <div id="time-slider" class="slidecontainer">
                <input type="range" min="0" max="100" value="0" class="slider" id="songTime">
            </div>
            <div class="time">
                <span id="total-time">0:00</span>
            </div>
        </div>
    </div>


        <div class="extras">
<!--        <div><i class="fas fa-list-ul"></i></div>-->
<!--        <div><i class="fas fa-laptop"></i></div>-->
            <div id="volume-icon"><i class="fas fa-volume-up" style="padding-right: 10px" ></i></div>
            <div class="slidecontainer" style="width:30%;">
                <input type="range" min="0" max="100" value="100" class="slider" id="volumeRange" style="margin-top:0; padding-bottom: 4px;">
            </div>
    </div>
</footer>
<audio id="audio-player" controls style="display:none;"></audio>

<script>
    // Function to create artist HTML element
    function createArtistElement(artist) {
        const artistDiv = document.createElement('div');
        artistDiv.innerHTML = `
                <a href="/detail/${artist.artistid}">
            <div>
                <img src="media/popular artists/${artist.artists_image}" alt="${artist.artists_name}">
<!--                <div><i class="fas fa-play"></i></div>-->
                <p>${artist.artists_name}</p>
            </div>
        </a>
            `;
        return artistDiv;
    }

    //Gọi api tất cả nghệ sĩ - JSON
    // Fetch and display artists using Axios
    axios.get('/api/artist/findAllArtist')
        .then(response => {
            const artistContainer = document.getElementById('artist-container');

            const artists = response.data.data;

            artists.forEach(artist => {
                const artistElement = createArtistElement(artist);
                artistContainer.appendChild(artistElement);
            });
        })
        .catch(error => {
            console.error('Error fetching artists:', error);
            // Handle error (e.g., display a message to the user)
        });
</script>


<script>
    document.addEventListener('DOMContentLoaded', function () {
        const songContainer = document.getElementById('song-container');
        const artistContainer = document.getElementById('artist-container');
        const audioPlayer = document.getElementById('audio-player');
        const footerSongImage = document.getElementById('song-image').querySelector('img');
        const footerSongName = document.querySelector('.song-desc div:nth-child(1)');
        const footerSongAuthor = document.querySelector('.song-desc div:nth-child(2)');
        const playPauseButton = document.getElementById('play-pause-button').querySelector('i');
        const currentTimeElement = document.getElementById('current-time');
        const totalTimeElement = document.getElementById('total-time');
        const timeSlider = document.getElementById('songTime');
        const volumeRange = document.getElementById('volumeRange');
        const nextButton = document.getElementById('next-button');
        const prevButton = document.getElementById('prev-button');
        const resetButton = document.getElementById('reset-button');
        const volumeIcon = document.getElementById('volume-icon');
        const randomButton = document.getElementById('random-button');
        const searchInput = document.getElementById('search-input');

        let currentSong = null;


        // Function to format time in mm:ss
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secondsRemaining = Math.floor(seconds % 60);
            return `${minutes}:${secondsRemaining < 10 ? '0' : ''}${secondsRemaining}`;
        }

        // Function to get all songs
        function getAllSongs() {
            return axios.get('/api-public/song/findAllSongs');
        }

        // Function to get song details by ID
        function getSongDetails(songId) {
            return axios.get(`/api-public/song/findSongId?songId=${songId}`);
        }

        // Function to render songs
        function renderSongs(songs) {
            songContainer.innerHTML = '';
            songs.forEach(song => {
                const songCard = `
            <div class="card" id="playSong" data-song-name="${song.song_name}">
                <div>
                    <img src="library/image/${song.image}">
                    <div class="play-button" data-song-id="${song.songID}" data-song-src="library/Music/${song.audio_file}"
                         data-song-image="library/image/${song.image}" data-song-name="${song.song_name}" data-song-author="${song.author}"
                         style="display: flex; justify-content: center; align-items: center; width: 100px; height: 100px;">
                        <i class="fas fa-play" style="width:50%; height:50%;"></i>
                    </div>
                </div>
                <div class="song-description">
                    <h3>${song.song_name}</h3>
                    <p>Aug 20, 2020</p>
                </div>
                <div class="options">
                    <label for="latest-release-checkbox"><i class="fas fa-ellipsis-h"></i></label>
                    <input type="checkbox" id="latest-release-checkbox">
                    <div class="latest-release-dropdown">
                        <div class="drop-item">
                            <p><i class="fas fa-play-circle"></i> <a href="SinglePlaylistScreen.html">Play Now</a></p>
                        </div>
                        <hr>
                        <div class="drop-item">
                            <p><i class="fas fa-list-ul"></i> Add to Queue</p>
                        </div>
                        <hr>
                        <div class="drop-item">
                            <p><i class="fas fa-music"></i> Add to playlist</p>
                        </div>
                        <hr>
                        <div class="drop-item">
                            <p><i class="fas fa-info-circle"></i> Get Info</p>
                        </div>
                    </div>
<!--                    <p>4:44</p>-->
                </div>
            </div>
        `;


                songContainer.innerHTML += songCard;
            });

            // Add event listeners to play buttons
            const playButtons = document.querySelectorAll('.play-button');
            playButtons.forEach(button => {
                button.addEventListener('click', function () {
                    const songId = this.getAttribute('data-song-id');
                    const songSrc = this.getAttribute('data-song-src');
                    const songImage = this.getAttribute('data-song-image');
                    const songName = this.getAttribute('data-song-name');
                    const songAuthor = this.getAttribute('data-song-author');
                    playPauseButton.innerHTML = '<i class="fas fa-pause-circle"></i>';

                    // Call getSongDetails with the selected song ID
                    getSongDetails(songId)
                        .then(function (response) {
                            if (response.status === 200) {
                                const songDetails = response.data;
                                console.log('Song Details:', songDetails);

                                // Update footer with song details
                                footerSongImage.src = songImage;
                                footerSongName.textContent = songName;
                                footerSongAuthor.textContent = songAuthor;

                                // Update the audio source and play the song
                                audioPlayer.src = songSrc;
                                audioPlayer.play();
                                let isThirtySecondsReached = false;
                                audioPlayer.addEventListener('timeupdate', function() {
                                    console.log("Thời gian hiện tại:", audioPlayer.currentTime);
                                    if (!isThirtySecondsReached && audioPlayer.currentTime >= 29) {
                                        isThirtySecondsReached = true;
                                        updateListenCount(songId);
                                    }
                                });

                                // Set the volume to maximum
                                audioPlayer.volume = 1;
                                volumeRange.value = 100;

                                // Update the play/pause button
                                playPauseButton.classList.remove('fa-play-circle');
                                playPauseButton.classList.add('fa-pause-circle');

                                // Set the current song
                                currentSong = {
                                    songId,
                                    songSrc,
                                    songImage,
                                    songName,
                                    songAuthor
                                };
                            } else {
                                alert('Failed to get song details');
                            }
                        })
                        .catch(function (error) {
                            console.error('Error fetching song details:', error);
                        });
                });
            });
        }

        // tìm kiếm
        searchInput.addEventListener('input', function () {
            const query = searchInput.value.toLowerCase();
            getAllSongs()
                .then(response => {
                    if (response.status === 200 && response.data.status === 'success') {
                        const songs = response.data.data.filter(song => song.song_name.toLowerCase().includes(query));

                        if (songs.length === 0) {
                            // Nếu không có bài hát nào khớp, hiển thị thông báo
                            renderNoSongsFound();
                        } else {
                            // Nếu có bài hát, hiển thị chúng
                            renderSongs(songs);
                        }
                    } else {
                        console.error('Failed to fetch songs');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        });


        // Hàm để hiển thị thông báo "Không có bài hát"
        function renderNoSongsFound() {
            songContainer.innerHTML = '<p>(Không có bài hát phừ hợp với tìm kiếm)</p>';
        }

        // Initial call to get all songs
        // getAllSongs()
        //     .then(function (response) {
        //         if (response.status === 200 && response.data.status === 'success') {
        //             const songs = response.data.data;
        //             console.log('All Songs:', songs);
        //             renderSongs(songs);
        //             playButtons = document.querySelectorAll('.play-button'); // Gán giá trị cho biến playButtons
        //         } else {
        //             alert(response.data.message || 'No songs found');
        //         }
        //     })
        //     .catch(function (error) {
        //         console.error('Error fetching songs:', error);
        //     });
        getAllSongs()
            .then(function (response) {
                if (response.status === 200 && response.data.status === 'success') {
                    const songs = response.data.data;
                    if (songs.length === 0) {
                        renderNoSongsFound();
                    } else {
                        console.log('All Songs:', songs);
                        renderSongs(songs);
                    }
                } else {
                    alert(response.data.message || 'No songs found');
                }
            })
            .catch(function (error) {
                console.error('Error fetching songs:', error);
            });

        // Play/pause button functionality
        playPauseButton.addEventListener('click', function () {
            if (audioPlayer.paused) {
                audioPlayer.play();
                playPauseButton.classList.remove('fa-play-circle');
                playPauseButton.classList.add('fa-pause-circle');
            } else {
                audioPlayer.pause();
                playPauseButton.classList.remove('fa-pause-circle');
                playPauseButton.classList.add('fa-play-circle');
            }
        });

        // Update the play/pause button when the song ends
        audioPlayer.addEventListener('ended', function () {
            playPauseButton.classList.remove('fa-pause-circle');
            playPauseButton.classList.add('fa-play-circle');
        });

        // Update current time and total time
        audioPlayer.addEventListener('timeupdate', function () {
            currentTimeElement.textContent = formatTime(audioPlayer.currentTime);
            timeSlider.value = (audioPlayer.currentTime / audioPlayer.duration) * 100;
        });

        // Set total time when metadata is loaded
        audioPlayer.addEventListener('loadedmetadata', function () {
            totalTimeElement.textContent = formatTime(audioPlayer.duration);
        });

        // Seek functionality
        timeSlider.addEventListener('input', function () {
            const seekTime = (timeSlider.value / 100) * audioPlayer.duration;
            audioPlayer.currentTime = seekTime;
        });

        // Volume control functionality
        volumeRange.addEventListener('input', function () {
            audioPlayer.volume = volumeRange.value / 100;
        });

        // Set initial volume to max
        audioPlayer.volume = 1;
        volumeRange.value = 100;

        // // Next button functionality
        // nextButton.addEventListener('click', function () {
        //     const currentButton = document.querySelector('.current-song');
        //     const playButtons = document.querySelectorAll('.play-button');
        //     const currentIndex = Array.from(playButtons).indexOf(currentButton);
        //     let nextIndex;
        //
        //     // if (currentIndex === playButtons.length - 1) {
        //     //     nextIndex = 0; // Quay lại bài hát đầu nếu đang ở cuối danh sách
        //     // } else {
        //     //     nextIndex = currentIndex + 1;
        //     // }
        //     if (currentIndex === 4) {
        //         nextIndex = 0; // Quay lại bài hát đầu nếu đang ở bài hát số 4
        //     } else {
        //         nextIndex = currentIndex + 1;
        //     }
        //
        //     const nextButton = playButtons[nextIndex];
        //     loadAndPlaySong(nextButton);
        // });

        // xử lí nút next
        nextButton.addEventListener('click', function () {
            if (isRandomActive) { // Kiểm tra xem nút Random có được kích hoạt không
                const playButtons = document.querySelectorAll('.play-button');
                const randomIndex = Math.floor(Math.random() * playButtons.length); // Chọn một số ngẫu nhiên từ 0 đến độ dài danh sách bài hát
                const randomButton = playButtons[randomIndex]; // Lấy phần tử ở vị trí ngẫu nhiên trong danh sách bài hát
                loadAndPlaySong(randomButton); // Tải và phát bài hát từ phần tử đã chọn ngẫu nhiên
            } else { // Nếu nút Random không được kích hoạt, thực hiện chức năng Next bình thường
                const currentButton = document.querySelector('.current-song');
                const playButtons = document.querySelectorAll('.play-button');
                const currentIndex = Array.from(playButtons).indexOf(currentButton);
                let nextIndex;

                if (currentIndex === playButtons.length - 1) {
                    nextIndex = 0; // Quay lại bài hát đầu nếu đang ở cuối danh sách
                } else {
                    nextIndex = currentIndex + 1;
                }

                const nextButton = playButtons[nextIndex];
                loadAndPlaySong(nextButton);
            }
        });

        // // Previous button functionality
        // prevButton.addEventListener('click', function () {
        //     const currentButton = document.querySelector('.current-song');
        //     const playButtons = document.querySelectorAll('.play-button');
        //     const currentIndex = Array.from(playButtons).indexOf(currentButton);
        //     let prevIndex;
        //
        //     // if (currentIndex === 0) {
        //     //     prevIndex = playButtons.length - 1; // Quay lại bài hát cuối nếu đang ở đầu danh sách
        //     // } else {
        //     //     prevIndex = currentIndex - 1;
        //     // }
        //     if (currentIndex === 0) {
        //         prevIndex = 4; // Quay lại bài hát số 4 nếu đang ở bài hát đầu
        //     } else {
        //         prevIndex = currentIndex - 1;
        //     }
        //
        //     const prevButton = playButtons[prevIndex];
        //     loadAndPlaySong(prevButton);
        // });


        // xử lí nút prev
        prevButton.addEventListener('click', function () {
            if (isRandomActive) { // Kiểm tra xem nút Random có được kích hoạt không
                const playButtons = document.querySelectorAll('.play-button');
                const randomIndex = Math.floor(Math.random() * playButtons.length); // Chọn một số ngẫu nhiên từ 0 đến độ dài danh sách bài hát
                const randomButton = playButtons[randomIndex]; // Lấy phần tử ở vị trí ngẫu nhiên trong danh sách bài hát
                loadAndPlaySong(randomButton); // Tải và phát bài hát từ phần tử đã chọn ngẫu nhiên
            } else { // Nếu nút Random không được kích hoạt, thực hiện chức năng Prev bình thường
                const currentButton = document.querySelector('.current-song');
                const playButtons = document.querySelectorAll('.play-button');
                const currentIndex = Array.from(playButtons).indexOf(currentButton);
                let prevIndex;

                if (currentIndex === 0) {
                    prevIndex = playButtons.length - 1; // Quay lại bài hát cuối nếu đang ở đầu danh sách
                } else {
                    prevIndex = currentIndex - 1;
                }

                const prevButton = playButtons[prevIndex];
                loadAndPlaySong(prevButton);
            }
        });


        // xử lí nút reset
        resetButton.addEventListener('click', function () {
            audioPlayer.currentTime = 0;
        });

        // // Function to load and play a song
        // function loadAndPlaySong(button) {
        //     const songId = button.getAttribute('data-song-id');
        //     const songSrc = button.getAttribute('data-song-src');
        //     const songImage = button.getAttribute('data-song-image');
        //     const songName = button.getAttribute('data-song-name');
        //     const songAuthor = button.getAttribute('data-song-author');
        //     playPauseButton.innerHTML = '<i class="fas fa-pause-circle"></i>';
        //
        //     // Update footer with song details
        //     footerSongImage.src = songImage;
        //     footerSongName.textContent = songName;
        //     footerSongAuthor.textContent = songAuthor;
        //
        //     // Update the audio source and play the song
        //     audioPlayer.src = songSrc;
        //     audioPlayer.play();
        //
        //     // Set the volume to maximum
        //     audioPlayer.volume = 1;
        //     volumeRange.value = 100;
        //
        //     // Update the play/pause button
        //     playPauseButton.classList.remove('fa-play-circle');
        //     playPauseButton.classList.add('fa-pause-circle');
        //
        //     // Set the current song
        //     currentSong = {
        //         songId,
        //         songSrc,
        //         songImage,
        //         songName,
        //         songAuthor
        //     };
        //     console.log(songSrc)
        //     // Remove 'current-song' class from current button
        //     const currentButton = document.querySelector('.current-song');
        //     if (currentButton) {
        //         currentButton.classList.remove('current-song');
        //     }
        //
        //     // Add 'current-song' class to the new button
        //     button.classList.add('current-song');
        // }


        // Hàm load và phát bài hát
        function loadAndPlaySong(button) {
            const songId = button.getAttribute('data-song-id');
            const songSrc = button.getAttribute('data-song-src');
            const songImage = button.getAttribute('data-song-image');
            const songName = button.getAttribute('data-song-name');
            const songAuthor = button.getAttribute('data-song-author');

            // Cập nhật footer với chi tiết bài hát
            footerSongImage.src = songImage;
            footerSongName.textContent = songName;
            footerSongAuthor.textContent = songAuthor;

            // Cập nhật nguồn audio và phát bài hát
            audioPlayer.src = songSrc;
            audioPlayer.play();

            // Đặt âm lượng về tối đa
            audioPlayer.volume = 1;
            volumeRange.value = 100;

            // Cập nhật nút play/pause
            playPauseButton.innerHTML = '<i class="fas fa-pause-circle"></i>';
            playPauseButton.classList.remove('fa-play-circle');
            playPauseButton.classList.add('fa-pause-circle');

            // Loại bỏ lớp 'current-song' từ nút hiện tại
            const currentButton = document.querySelector('.current-song');
            if (currentButton) {
                currentButton.classList.remove('current-song');
            }

            // Thêm lớp 'current-song' vào nút mới
            button.classList.add('current-song');
        }

        // Xử lý sự kiện cho nút Random
        let isRandomActive = false;

        randomButton.addEventListener('click', function () {
            isRandomActive = !isRandomActive; // Đảo ngược trạng thái của nút Random
            if (isRandomActive) {
                randomButton.style.color = 'green'; // Đổi màu nút Random thành xanh
            } else {
                randomButton.style.color = ''; // Đặt màu trở lại mặc định
            }
        });


        // xử lí cho nút tắt giảm âm lượng
        volumeIcon.addEventListener('click', function () {
            if (audioPlayer.volume > 0) {
                audioPlayer.volume = 0;
                volumeRange.value = 0;
            } else {
                audioPlayer.volume = 1;
                volumeRange.value = 100;
            }
        });
    });


    // Get audio element
    var audio = document.getElementById("audio-player");

    // Get play/pause button
    var playPauseButton = document.getElementById("play-pause-button");

    // Play/pause function
    function togglePlayPause() {
        if (audio.paused) {
            audio.play();
            playPauseButton.innerHTML = '<i class="fas fa-pause-circle"></i>';
        } else {
            audio.pause();
            playPauseButton.innerHTML = '<i class="fas fa-play-circle"></i>';
        }
    }

    // Add click event listener to play/pause button
    playPauseButton.addEventListener("click", togglePlayPause);

    // Update current time and total time
    audio.addEventListener("timeupdate", function () {
        var currentTime = document.getElementById("current-time");
        var totalTime = document.getElementById("total-time");
        currentTime.innerHTML = formatTime(audio.currentTime);
        totalTime.innerHTML = formatTime(audio.duration);
    });

    // Function to format time (mm:ss)
    function formatTime(time) {
        var minutes = Math.floor(time / 60);
        var seconds = Math.floor(time % 60);
        return minutes + ":" + (seconds < 10 ? "0" : "") + seconds;
    }

    // Volume control
    var volumeRange = document.getElementById("volumeRange");
    volumeRange.addEventListener("change", function () {
        audio.volume = volumeRange.value / 100;
    });
    // Lấy phần tử thanh trượt thời gian
    var timeSlider = document.getElementById("songTime");

    // Khi bài hát được phát, cập nhật giá trị của thanh trượt thời gian
    audio.addEventListener("timeupdate", function () {
        var currentTime = audio.currentTime;
        var duration = audio.duration;
        var percentage = (currentTime / duration) * 100;
        timeSlider.value = percentage;
    });

    // Khi người dùng di chuyển thanh trượt, điều chỉnh thời gian của bài hát
    timeSlider.addEventListener("input", function () {
        var percentage = timeSlider.value;
        var duration = audio.duration;
        var currentTime = (percentage * duration) / 100;
        audio.currentTime = currentTime;
    });
    // Lấy phần tử thanh trượt thời gian
    var timeSlider = document.getElementById("songTime");

    // Khi bài hát được phát, cập nhật giá trị của thanh trượt thời gian và tạo biến --range-value
    audio.addEventListener("timeupdate", function () {
        var currentTime = audio.currentTime;
        var duration = audio.duration;
        var percentage = (currentTime / duration) * 100;
        timeSlider.value = percentage;
        timeSlider.style.setProperty('--range-value', percentage + '%');
    });

    // sắp xếp
    document.getElementById('sort-asc').addEventListener('click', function () {
        sortSongs('asc');
    });

    document.getElementById('sort-desc').addEventListener('click', function () {
        sortSongs('desc');
    });

    // Các hàm khác trong JavaScript
    function sortSongs(order) {
        const container = document.getElementById('song-container');
        const songs = Array.from(container.getElementsByClassName('card'));

        songs.sort(function (a, b) {
            const nameA = (a.getAttribute('data-song-name') || '').toUpperCase();
            const nameB = (b.getAttribute('data-song-name') || '').toUpperCase();

            if (order === 'asc') {
                return nameA.localeCompare(nameB);
            } else if (order === 'desc') {
                return nameB.localeCompare(nameA);
            }
        });

        // Clear the container and append sorted songs
        while (container.firstChild) {
            container.removeChild(container.firstChild);
        }

        songs.forEach(function (song) {
            container.appendChild(song);
        });
    }


</script>
<script>
    document.getElementById("profile-picture").addEventListener("click", function() {
        var xhr = new XMLHttpRequest();
        xhr.open("GET", "/check-login-status", true);
        xhr.onreadystatechange = function() {
            if (xhr.readyState === 4 && xhr.status === 200) {
                var isLoggedIn = xhr.responseText;
                if (isLoggedIn === "true") {
                    window.location.href = "/myprofile";
                } else {
                    window.location.href = "/login";
                }
            }
        };
        xhr.send();
    });
</script>
<script>
    function updateListenCount(songId) {
        console.log("Đã gọi hàm updateListenCount với songId:", songId);
        axios.post('/update-listen-count', { songId: songId })
            .then(function(response) {
                if (response.data.status) {
                    console.log("Cập nhật lượt nghe thành công!");
                } else {
                    console.error("Cập nhật lượt nghe thất bại!");
                }
            })
            .catch(function(error) {
                console.error("Có lỗi xảy ra khi cập nhật lượt nghe:", error);
            });
    }
</script>
<script src="JS/trending.js"></script>
</body>

</html>