<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scooped- Playlist</title>
    <!-- it is connected to two stylesheets -->
    <link rel="stylesheet" type="text/css" href="/Single%20Playlist%20Screen%20Styles.css">
    <!-- this is the main stylesheet -->
    <!-- desktop first approach is used for the same. -->
    <link rel="stylesheet" type="text/css" href="/Secondary%20page%20responsive.css">
    <!-- this is the style sheet with all the media queries -->
    <!-- this script is just for font awesome fonts -->
    <script src="https://kit.fontawesome.com/2d9b67a497.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<!-- body -->

<body>
<!-- top navigation bar -->
<nav class="navigation-bar">
    <!-- this div contains the logo and title os the page -->
    <div class="title-combo">
        <div class="website-logo">
            <a href="/MusicMp3">
                <img src="/media/website_logo.svg"></a>
        </div>
        <div class="website-name">
            <h1>
                <a href="/MusicMp3">
                    Scooped
                </a>
            </h1>
            <h4 style="color: magenta;">
                <a href="index.html">Online Music Player</a>
            </h4>
        </div>
    </div>
    <!-- this is the animated favourites text -->
    <div class="favs">
        <h4>
            Artist
        </h4>
    </div>
<!--    <div class="search-bar">-->
<!--        <div>-->
<!--            &lt;!&ndash; magnifying glass- search icon &ndash;&gt;-->
<!--            <i class="fas fa-search search-ico"></i>-->
<!--        </div>-->
<!--        <input type="text" id="search-input" name="search" placeholder="Search">-->
<!--&lt;!&ndash;        <div>&ndash;&gt;-->
<!--&lt;!&ndash;            &lt;!&ndash; mic icon &ndash;&gt;&ndash;&gt;-->
<!--&lt;!&ndash;            <i class="fas fa-microphone mic-ico"></i>&ndash;&gt;-->
<!--&lt;!&ndash;        </div>&ndash;&gt;-->
<!--    </div>-->
    <!-- this is for notification bell -->
<!--    <div class="notification-bell">-->
<!--        <img src="/media/bell_icon.svg">-->

<!--    </div>-->
    <!-- this is for profile picture -->
<!--    <div class="profile-picture">-->
<!--        <img src="/media/profile_picture.svg">-->
<!--    </div>-->
</nav>
<!-- this is the main center part of the page and it is divided into two sections, namely section 1 and section 2-->
<!-- I have separated these sections using the aside tag for each section -->
<main>
    <!-- aside section 1 -->
    <aside class="aside section-1">
        <!-- this is for the jumbotron -->
        <div class="jumbotron">
            <div class=jumbotron-image>
                <!-- there is nothing in this div because all the images and all are added by css -->
                <img id="artist-image" style="width: 80%" src="">
            </div>
            <!-- jumbotron details -->
            <div class="jumbotron-detail">
                <!-- descriptive part of the jumbotron this will contain name , number of followers and all -->
                <div class="descriptive-part">
                    <!--                        <div class="song-name-main">-->
                    <!--                            <h1>ColdPlay</h1>-->
                    <!--                        </div>-->
                    <!--                        <div class="followers">-->
                    <!--                            851 Followers-->
                    <!--                        </div>-->
                    <p style="font-size: 50px; font-weight: bold" class="author" id="artist-name"></p>

                                            <p class="desc" id="artist-description">

                                            </p>
                </div>
                <!-- action part -->
                <!--                    <div class="action-part">-->
                <!--                        &lt;!&ndash; action buttons &ndash;&gt;-->
                <!--                        <div class="btns">-->
                <!--                            <button>Play All</button>-->
                <!--                            <button>Follow</button>-->
                <!--                        </div>-->
                <!--                        <p>-->
                <!--                            247 Tracks | 128 Albums-->
                <!--                        </p>-->
                <!--                    </div>-->
            </div>
        </div>
        <!-- now the playlist part begins -->
        <div class="playlist-items" id="songs-container">
            <!-- playlist item -->

        </div>
    </aside>
    <!-- one aside section is complete -->
    <!-- now the second aside section will start from here -->
    <!-- the page is responsive. please try reducing the width of the page -->
    <!-- the aside section will collapse and a "more button will be shown to you." -->
    <!-- clicking on this more button, you will be shown the aside section 2  -->
    <!-- its position will be absolute at lower resolutions -->
    <!-- this is the label for that more button -->
    <label for="more"><i class="fas fa-angle-double-left"></i>More</label>
    <!-- this is that more button -->
    <!-- and this is the check box. this will always be hidden -->
    <!-- check the stylesheet_main.css when the label is clicked, this checkbox will be checked -->
    <!-- which will invoke the aside section 2 on lower resolutions -->
    <input type="checkbox" id="more">
    <!-- </div> -->
<!--    <aside class="aside section-2">-->
<!--        &lt;!&ndash; similar class will be applicable to both similar artists and recently played &ndash;&gt;-->

<!--    </aside>-->
</main>


<!-- main part of the page is over. -->
<!-- this is the footer part. -->
<!-- its position will be fixed to the screen bottom. -->
<footer>
    <div class="active-song-description">
        <div id="song-image">
            <img src="/media/latest english/roar.jpg" alt="Current song image">
        </div>
        <div class="song-desc">
            <div>Imagine by John</div>
            <div>John Lennon</div>
        </div>
        <!--        <div class="heart-and-ban-icon">-->
        <!--            <span>-->
        <!--                <i class="far fa-heart"></i>-->
        <!--            </span>-->
        <!--            <span>-->
        <!--                <i class="fas fa-ban"></i>-->
        <!--            </span>-->
        <!--        </div>-->
    </div>
    <div class="player">
        <div class="controls">
            <div id="random-button"><i class="fas fa-random"></i></div>
            <div id="prev-button"><i class="fas fa-step-backward"></i></div>
            <div id="play-pause-button"><i class="fas fa-play-circle"></i></div>
            <div id="next-button"><i class="fas fa-step-forward"></i></div>
            <div id="reset-button"><i class="fas fa-redo"></i></div>
        </div>
        <div id="slider">
            <div class="time">
                <span id="current-time">0:00</span>
            </div>
            <div id="time-slider" class="slidecontainer">
                <input type="range" min="0" max="100" value="0" class="slider" id="songTime">
            </div>
            <div class="time">
                <span id="total-time">0:00</span>
            </div>
        </div>
    </div>


    <div class="extras">
        <!--        <div><i class="fas fa-list-ul"></i></div>-->
        <!--        <div><i class="fas fa-laptop"></i></div>-->
        <div id="volume-icon"><i class="fas fa-volume-up" style="padding-right: 10px" ></i></div>
        <div class="slidecontainer" style="width:30%;">
            <input type="range" min="0" max="100" value="100" class="slider" id="volumeRange" style="margin-top:0; padding-bottom: 4px;">
        </div>
    </div>
</footer>
<audio id="audio-player" controls style="display:none;"></audio>
</body>
<!-- Script for detail page -->

<script>


    function getSongDetails(songId) {
        return axios.get(`/api-public/song/findSongId?songId=${songId}`);
    }

    document.addEventListener('DOMContentLoaded', function () {
        const pathParts = window.location.pathname.split('/');
        const artistId = pathParts[pathParts.length - 1];
        const audioPlayer = document.getElementById('audio-player');
        const footerSongImage = document.getElementById('song-image').querySelector('img');
        const footerSongName = document.querySelector('.song-desc div:nth-child(1)');
        const footerSongAuthor = document.querySelector('.song-desc div:nth-child(2)');
        const playPauseButton = document.getElementById('play-pause-button').querySelector('i');
        const currentTimeElement = document.getElementById('current-time');
        const totalTimeElement = document.getElementById('total-time');
        const timeSlider = document.getElementById('songTime');
        const volumeRange = document.getElementById('volumeRange');
        const nextButton = document.getElementById('next-button');
        const prevButton = document.getElementById('prev-button');
        const resetButton = document.getElementById('reset-button');
        const volumeIcon = document.getElementById('volume-icon');
        const randomButton = document.getElementById('random-button');
        const searchInput = document.getElementById('search-input');

        if (artistId) {
            // Gọi API để lấy thông tin nghệ sĩ
            axios.get(`/api/artist/findById/${artistId}`)
                .then(response => {
                    const data = response.data;
                    if (data.status === 'success') {
                        const artist = data.data;

                        // Hiển thị thông tin nghệ sĩ
                        document.getElementById('artist-image').src = `/media/popular artists/${artist.artists_image}`;
                        document.getElementById('artist-name').textContent = artist.artists_name;
                        document.getElementById('artist-description').textContent = artist.artists_description;

                        // Gọi API để lấy danh sách bài hát của nghệ sĩ
                        axios.get(`/api/artist/byArtist/${artistId}`)
                            .then(response => {
                                const songs = response.data;
                                const songsContainer = document.getElementById('songs-container');
                                songs.forEach((song, index) => {
                                    const songDiv = document.createElement('div');
                                    songDiv.className = 'playlist-item';
                                    songDiv.innerHTML = `
                                        <div class="left">
                                            <div>${String(index + 1).padStart(2, '0')}</div>
                                            <div>
                                                <img src="/library/image/${song.image}" alt="${song.song_name}">
                                                <div class="play-btn" data-song-id="${song.songID}" data-song-src="/library/Music/${song.audio_file}"
                         data-song-image="/library/image/${song.image}" data-song-name="${song.song_name}" data-song-author="${song.artist.artists_name}">
                                                    <i class="fas fa-play"></i>
                                                </div>
                                            </div>
                                            <div>
                                                <h5>${song.song_name}</h5>
                                                 <!-- Đổi thành tên của nghệ sĩ từ phản hồi API -->
                                            </div>
                                        </div>
<!--                                        <div class="center">-->
<!--                                            4:44-->
<!--                                        </div>-->
<!--                                        <div class="right">-->
<!--                                            <div>-->
<!--                                                <i class="far fa-heart"></i>-->
<!--                                            </div>-->
<!--                                            <div>-->
<!--                                                <i class="fas fa-plus"></i>-->
<!--                                            </div>-->
<!--                                        </div>-->
                                    `;
                                    songsContainer.appendChild(songDiv);
                                });

                                // Add event listeners to play buttons
                                const playButtons = document.querySelectorAll('.play-btn');
                                playButtons.forEach(button => {
                                    button.addEventListener('click', function () {
                                        const songId = this.getAttribute('data-song-id');
                                        const songSrc = this.getAttribute('data-song-src');
                                        const songImage = this.getAttribute('data-song-image');
                                        const songName = this.getAttribute('data-song-name');
                                        const songAuthor = this.getAttribute('data-song-author');
                                        playPauseButton.innerHTML = '<i class="fas fa-pause-circle"></i>';

                                        // Call getSongDetails with the selected song ID
                                        getSongDetails(songId)
                                            .then(function (response) {
                                                if (response.status === 200) {
                                                    const songDetails = response.data;
                                                    console.log('Song Details:', songDetails);

                                                    // Update footer with song details
                                                    footerSongImage.src = songImage;
                                                    footerSongName.textContent = songName;
                                                    footerSongAuthor.textContent = songAuthor;

                                                    // Update the audio source and play the song
                                                    audioPlayer.src = songSrc;
                                                    audioPlayer.play();

                                                    // Set the volume to maximum
                                                    audioPlayer.volume = 1;
                                                    volumeRange.value = 100;

                                                    // Update the play/pause button
                                                    playPauseButton.classList.remove('fa-play-circle');
                                                    playPauseButton.classList.add('fa-pause-circle');

                                                    // Set the current song
                                                    currentSong = {
                                                        songId,
                                                        songSrc,
                                                        songImage,
                                                        songName,
                                                        songAuthor
                                                    };
                                                } else {
                                                    alert('Failed to get song details');
                                                }
                                            })
                                            .catch(function (error) {
                                                console.error('Error fetching song details:', error);
                                            });
                                    });
                                });


                            })
                            .catch(error => {
                                console.error('Error fetching songs:', error);
                            });
                    } else {
                        console.error('Artist not found');
                    }
                })
                .catch(error => {
                    console.error('Error fetching artist details:', error);
                });
        } else {
            console.error('No artistId found in URL');
        }



        // Play/pause button functionality
        playPauseButton.addEventListener('click', function () {
            if (audioPlayer.paused) {
                audioPlayer.play();
                playPauseButton.classList.remove('fa-play-circle');
                playPauseButton.classList.add('fa-pause-circle');
            } else {
                audioPlayer.pause();
                playPauseButton.classList.remove('fa-pause-circle');
                playPauseButton.classList.add('fa-play-circle');
            }
        });

        // Update the play/pause button when the song ends
        audioPlayer.addEventListener('ended', function () {
            playPauseButton.classList.remove('fa-pause-circle');
            playPauseButton.classList.add('fa-play-circle');
        });

        // Update current time and total time
        audioPlayer.addEventListener('timeupdate', function () {
            currentTimeElement.textContent = formatTime(audioPlayer.currentTime);
            timeSlider.value = (audioPlayer.currentTime / audioPlayer.duration) * 100;
        });

        // Set total time when metadata is loaded
        audioPlayer.addEventListener('loadedmetadata', function () {
            totalTimeElement.textContent = formatTime(audioPlayer.duration);
        });

        // Seek functionality
        timeSlider.addEventListener('input', function () {
            const seekTime = (timeSlider.value / 100) * audioPlayer.duration;
            audioPlayer.currentTime = seekTime;
        });

        // Volume control functionality
        volumeRange.addEventListener('input', function () {
            audioPlayer.volume = volumeRange.value / 100;
        });

        // Set initial volume to max
        audioPlayer.volume = 1;
        volumeRange.value = 100;

        nextButton.addEventListener('click', function () {
            if (isRandomActive) { // Kiểm tra xem nút Random có được kích hoạt không
                const playButtons = document.querySelectorAll('.play-btn');
                const randomIndex = Math.floor(Math.random() * playButtons.length); // Chọn một số ngẫu nhiên từ 0 đến độ dài danh sách bài hát
                const randomButton = playButtons[randomIndex]; // Lấy phần tử ở vị trí ngẫu nhiên trong danh sách bài hát
                loadAndPlaySong(randomButton); // Tải và phát bài hát từ phần tử đã chọn ngẫu nhiên
            } else { // Nếu nút Random không được kích hoạt, thực hiện chức năng Next bình thường
                const currentButton = document.querySelector('.current-song');
                const playButtons = document.querySelectorAll('.play-btn');
                const currentIndex = Array.from(playButtons).indexOf(currentButton);
                let nextIndex;

                if (currentIndex === playButtons.length - 1) {
                    nextIndex = 0; // Quay lại bài hát đầu nếu đang ở cuối danh sách
                } else {
                    nextIndex = currentIndex + 1;
                }

                const nextButton = playButtons[nextIndex];
                loadAndPlaySong(nextButton);
            }
        });

        // // Previous button functionality
        // prevButton.addEventListener('click', function () {
        //     const currentButton = document.querySelector('.current-song');
        //     const playButtons = document.querySelectorAll('.play-button');
        //     const currentIndex = Array.from(playButtons).indexOf(currentButton);
        //     let prevIndex;
        //
        //     // if (currentIndex === 0) {
        //     //     prevIndex = playButtons.length - 1; // Quay lại bài hát cuối nếu đang ở đầu danh sách
        //     // } else {
        //     //     prevIndex = currentIndex - 1;
        //     // }
        //     if (currentIndex === 0) {
        //         prevIndex = 4; // Quay lại bài hát số 4 nếu đang ở bài hát đầu
        //     } else {
        //         prevIndex = currentIndex - 1;
        //     }
        //
        //     const prevButton = playButtons[prevIndex];
        //     loadAndPlaySong(prevButton);
        // });


        // xử lí nút prev
        prevButton.addEventListener('click', function () {
            if (isRandomActive) { // Kiểm tra xem nút Random có được kích hoạt không
                const playButtons = document.querySelectorAll('.play-btn');
                const randomIndex = Math.floor(Math.random() * playButtons.length); // Chọn một số ngẫu nhiên từ 0 đến độ dài danh sách bài hát
                const randomButton = playButtons[randomIndex]; // Lấy phần tử ở vị trí ngẫu nhiên trong danh sách bài hát
                loadAndPlaySong(randomButton); // Tải và phát bài hát từ phần tử đã chọn ngẫu nhiên
            } else { // Nếu nút Random không được kích hoạt, thực hiện chức năng Prev bình thường
                const currentButton = document.querySelector('.current-song');
                const playButtons = document.querySelectorAll('.play-btn');
                const currentIndex = Array.from(playButtons).indexOf(currentButton);
                let prevIndex;

                if (currentIndex === 0) {
                    prevIndex = playButtons.length - 1; // Quay lại bài hát cuối nếu đang ở đầu danh sách
                } else {
                    prevIndex = currentIndex - 1;
                }

                const prevButton = playButtons[prevIndex];
                loadAndPlaySong(prevButton);
            }
        });


        // xử lí nút reset
        resetButton.addEventListener('click', function () {
            audioPlayer.currentTime = 0;
        });

        // // Function to load and play a song
        // function loadAndPlaySong(button) {
        //     const songId = button.getAttribute('data-song-id');
        //     const songSrc = button.getAttribute('data-song-src');
        //     const songImage = button.getAttribute('data-song-image');
        //     const songName = button.getAttribute('data-song-name');
        //     const songAuthor = button.getAttribute('data-song-author');
        //     playPauseButton.innerHTML = '<i class="fas fa-pause-circle"></i>';
        //
        //     // Update footer with song details
        //     footerSongImage.src = songImage;
        //     footerSongName.textContent = songName;
        //     footerSongAuthor.textContent = songAuthor;
        //
        //     // Update the audio source and play the song
        //     audioPlayer.src = songSrc;
        //     audioPlayer.play();
        //
        //     // Set the volume to maximum
        //     audioPlayer.volume = 1;
        //     volumeRange.value = 100;
        //
        //     // Update the play/pause button
        //     playPauseButton.classList.remove('fa-play-circle');
        //     playPauseButton.classList.add('fa-pause-circle');
        //
        //     // Set the current song
        //     currentSong = {
        //         songId,
        //         songSrc,
        //         songImage,
        //         songName,
        //         songAuthor
        //     };
        //     console.log(songSrc)
        //     // Remove 'current-song' class from current button
        //     const currentButton = document.querySelector('.current-song');
        //     if (currentButton) {
        //         currentButton.classList.remove('current-song');
        //     }
        //
        //     // Add 'current-song' class to the new button
        //     button.classList.add('current-song');
        // }


        // Hàm load và phát bài hát
        function loadAndPlaySong(button) {
            const songId = button.getAttribute('data-song-id');
            const songSrc = button.getAttribute('data-song-src');
            const songImage = button.getAttribute('data-song-image');
            const songName = button.getAttribute('data-song-name');
            const songAuthor = button.getAttribute('data-song-author');

            // Cập nhật footer với chi tiết bài hát
            footerSongImage.src = songImage;
            footerSongName.textContent = songName;
            footerSongAuthor.textContent = songAuthor;

            // Cập nhật nguồn audio và phát bài hát
            audioPlayer.src = songSrc;
            audioPlayer.play();

            // Đặt âm lượng về tối đa
            audioPlayer.volume = 1;
            volumeRange.value = 100;

            // Cập nhật nút play/pause
            playPauseButton.innerHTML = '<i class="fas fa-pause-circle"></i>';
            playPauseButton.classList.remove('fa-play-circle');
            playPauseButton.classList.add('fa-pause-circle');

            // Loại bỏ lớp 'current-song' từ nút hiện tại
            const currentButton = document.querySelector('.current-song');
            if (currentButton) {
                currentButton.classList.remove('current-song');
            }

            // Thêm lớp 'current-song' vào nút mới
            button.classList.add('current-song');
        }

        // Xử lý sự kiện cho nút Random
        let isRandomActive = false;

        randomButton.addEventListener('click', function () {
            isRandomActive = !isRandomActive; // Đảo ngược trạng thái của nút Random
            if (isRandomActive) {
                randomButton.style.color = 'green'; // Đổi màu nút Random thành xanh
            } else {
                randomButton.style.color = ''; // Đặt màu trở lại mặc định
            }
        });


        // xử lí cho nút tắt giảm âm lượng
        volumeIcon.addEventListener('click', function () {
            if (audioPlayer.volume > 0) {
                audioPlayer.volume = 0;
                volumeRange.value = 0;
            } else {
                audioPlayer.volume = 1;
                volumeRange.value = 100;
            }
        });
    });



    // Get audio element
    var audio = document.getElementById("audio-player");

    // Get play/pause button
    var playPauseButton = document.getElementById("play-pause-button");

    // Play/pause function
    function togglePlayPause() {
        if (audio.paused) {
            audio.play();
            playPauseButton.innerHTML = '<i class="fas fa-pause-circle"></i>';
        } else {
            audio.pause();
            playPauseButton.innerHTML = '<i class="fas fa-play-circle"></i>';
        }
    }

    // Add click event listener to play/pause button
    playPauseButton.addEventListener("click", togglePlayPause);

    // Update current time and total time
    audio.addEventListener("timeupdate", function () {
        var currentTime = document.getElementById("current-time");
        var totalTime = document.getElementById("total-time");
        currentTime.innerHTML = formatTime(audio.currentTime);
        totalTime.innerHTML = formatTime(audio.duration);
    });

    // Function to format time (mm:ss)
    function formatTime(time) {
        var minutes = Math.floor(time / 60);
        var seconds = Math.floor(time % 60);
        return minutes + ":" + (seconds < 10 ? "0" : "") + seconds;
    }

    // Volume control
    var volumeRange = document.getElementById("volumeRange");
    volumeRange.addEventListener("change", function () {
        audio.volume = volumeRange.value / 100;
    });
    // Lấy phần tử thanh trượt thời gian
    var timeSlider = document.getElementById("songTime");

    // Khi bài hát được phát, cập nhật giá trị của thanh trượt thời gian
    audio.addEventListener("timeupdate", function () {
        var currentTime = audio.currentTime;
        var duration = audio.duration;
        var percentage = (currentTime / duration) * 100;
        timeSlider.value = percentage;
    });

    // Khi người dùng di chuyển thanh trượt, điều chỉnh thời gian của bài hát
    timeSlider.addEventListener("input", function () {
        var percentage = timeSlider.value;
        var duration = audio.duration;
        var currentTime = (percentage * duration) / 100;
        audio.currentTime = currentTime;
    });
    // Lấy phần tử thanh trượt thời gian
    var timeSlider = document.getElementById("songTime");

    // Khi bài hát được phát, cập nhật giá trị của thanh trượt thời gian và tạo biến --range-value
    audio.addEventListener("timeupdate", function () {
        var currentTime = audio.currentTime;
        var duration = audio.duration;
        var percentage = (currentTime / duration) * 100;
        timeSlider.value = percentage;
        timeSlider.style.setProperty('--range-value', percentage + '%');
    });
</script>

</html>