<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scooped -Online Music Player</title>
    <!-- it is connected to two stylesheets -->
    <link href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-dark@4/dark.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="Stylesheet_main.css"><!-- this is the main stylesheet -->
    <!-- desktop first approach is used for the same. -->
    <link rel="stylesheet" type="text/css" href="primary page responsive.css">
    <!-- this is the style sheet with all the media queries -->
    <!-- this script is just for font awesome fonts -->
    <script src="https://kit.fontawesome.com/2d9b67a497.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

</head>
<!-- body -->
<style>
    /* Tô màu cho phần đã phát của thanh trượt */
    input[type="range"]::-webkit-slider-runnable-track {
        background: linear-gradient(to right, #3498db 0%, #3498db calc(var(--range-value, 0%)), #ddd calc(var(--range-value, 0%) + 1px), #ddd 100%);
    }
    body {
        font-family: "Open Sans", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", Helvetica, Arial, sans-serif;
    }
</style>

<body>
<!-- top navigation bar -->
<nav class="navigation-bar" style="padding-top: 20px">
    <!-- this div contains the logo and title os the page -->
    <div class="title-combo">
        <div class="website-logo">
            <a href="/MusicMp3">
                <img src="media/website_logo.svg"></a>
        </div>
        <div class="website-name">
            <h1>
                <a href="/MusicMp3">Scooped</a>
            </h1>
            <h4>
                <a href="/MusicMp3">Online Music Player</a>
            </h4>
        </div>
    </div>
    <!-- this is for search bar -->
<!--    <div class="search-bar">-->
<!--        <div>-->
<!--            &lt;!&ndash; magnifying glass- search icon &ndash;&gt;-->
<!--            <i class="fas fa-search search-ico"></i>-->
<!--        </div>-->
<!--        <input type="text" name="search" placeholder="Search">-->
<!--        <div>-->
<!--            &lt;!&ndash; mic icon &ndash;&gt;-->
<!--            <i class="fas fa-microphone mic-ico"></i>-->
<!--        </div>-->
<!--    </div>-->
    <!-- this is for notification bell -->

    <!-- this is for profile picture -->
    <div class="profile-picture">
        <a href="/MusicMp3">
            <img src="media/profile_picture.svg"></a>
    </div>
</nav>

<!-- main part of the page is over. -->
<!-- this is the footer part. -->
<!-- its position will be fixed to the screen bottom. -->
<div style="display: flex; margin-top: 25px;">
    <aside style="background-color: #231b2e; width: 20%; height: 629px;">
        <div style="margin-top: 15px;">
            <a href="/myprofile"><button style="width: 95%; height: 30px; margin: 5px; border-radius: 5px; border: 1px solid #e5e6e8; cursor: pointer; ">
                My profile</button></a>
            <a href="/reset"><button style="width: 95%; height: 30px; margin: 5px; border-radius: 5px; border: 1px solid #e5e6e8; cursor: pointer;">
                Change Password</button></a>
            <button id="logout" style="width: 95%; height: 30px; margin: 5px; border-radius: 5px; border: 1px solid #e5e6e8; cursor: pointer;">
                Log out</button>
        </div>
    </aside>
    <article style="background-color: #170f23; width: 80%; height: 629px;">
        <div style="margin-left: 20px; margin-bottom: 20px; width: 97%; height: 90px;">
            <p style="font-size: xx-large; padding: 10px;">My profile</p>
            <span style="padding: 10px;">Manage profile information for account security</span>
        </div>
        <div style="margin-left: 30px;">
            <form action="/updateProfile" method="post"> <!-- Thêm form và action -->
                <div>
                    <span style="padding-right: 25px;">UserName</span>
                    <span th:text="${username}"></span>
                </div>
                <br>
                <div>
                    <span style="padding-right: 55px;">Name</span>
                    <input id="nameInput" name="name" th:value="${name}" style="border-radius: 5px; border: 1px solid #e5e6e8; width: 40%; height: 35px;" type="text">
                </div>

                <br>
                <div>
                    <span style="padding-right: 60px;">Email</span>
                    <input style="border-radius: 5px; border: 1px solid #e5e6e8; width: 40%; height: 35px;" type="text" th:value="${email}" readonly>
                </div>
                <br>
                <div>
                    <span style="padding-right: 52px;">Phone</span>
                    <input id="phoneInput" name="phone" th:value="${phone}" style="border-radius: 5px; border: 1px solid #e5e6e8; width: 40%; height: 30px;" type="text">
                </div>
                <br>
                <div>
                    <button id="submitButton" style="margin-left: 50px; margin-top: 25px; width: 25%; height: 30px; border-radius: 5px; border: 1px solid #e5e6e8; cursor: pointer;">Submit</button>
                </div>
            </form>
        </div>
    </article>
</div>
<audio id="audio-player" controls style="display:none;"></audio>


<script>
    document.addEventListener('DOMContentLoaded', function () {
        const songContainer = document.getElementById('song-container');
        const audioPlayer = document.getElementById('audio-player');
        const footerSongImage = document.getElementById('song-image').querySelector('img');
        const footerSongName = document.querySelector('.song-desc div:nth-child(1)');
        const footerSongAuthor = document.querySelector('.song-desc div:nth-child(2)');
        const playPauseButton = document.getElementById('play-pause-button').querySelector('i');
        const currentTimeElement = document.getElementById('current-time');
        const totalTimeElement = document.getElementById('total-time');
        const timeSlider = document.getElementById('songTime');
        const volumeRange = document.getElementById('volumeRange');

        let currentSong = null;

        // Function to format time in mm:ss
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secondsRemaining = Math.floor(seconds % 60);
            return `${minutes}:${secondsRemaining < 10 ? '0' : ''}${secondsRemaining}`;
        }

        // Function to get all songs
        function getAllSongs() {
            return axios.get('/api-public/song/findAllSongs');
        }

        // Function to get song details by ID
        function getSongDetails(songId) {
            return axios.get(`/api-public/song/findSongId?songId=${songId}`);
        }

        // Function to render songs
        function renderSongs(songs) {
            songs.forEach(song => {
                const songCard = `
            <div class="card" id="playSong">
                <div>
                    <img src="library/image/${song.image}">
                    <div class="play-button" data-song-id="${song.songID}" data-song-src="library/Music/${song.audio_file}"
                         data-song-image="library/image/${song.image}" data-song-name="${song.song_name}" data-song-author="${song.author}">
                        <i class="fas fa-play" style="width:100%; height:100%; display:inline-block"></i>
                    </div>
                </div>
                <div class="song-description">
                    <h3>${song.song_name}</h3>
                    <p>Aug 20, 2020</p>
                </div>
                <div class="options">
                    <label for="latest-release-checkbox"><i class="fas fa-ellipsis-h"></i></label>
                    <input type="checkbox" id="latest-release-checkbox">
                    <div class="latest-release-dropdown">
                        <div class="drop-item">
                            <p><i class="fas fa-play-circle"></i> <a href="SinglePlaylistScreen.html">Play Now</a></p>
                        </div>
                        <hr>
                        <div class="drop-item">
                            <p><i class="fas fa-list-ul"></i> Add to Queue</p>
                        </div>
                        <hr>
                        <div class="drop-item">
                            <p><i class="fas fa-music"></i> Add to playlist</p>
                        </div>
                        <hr>
                        <div class="drop-item">
                            <p><i class="fas fa-info-circle"></i> Get Info</p>
                        </div>
                    </div>
                    <p>4:44</p>
                </div>
            </div>
        `;
                songContainer.innerHTML += songCard;
            });

            // Add event listeners to play buttons
            const playButtons = document.querySelectorAll('.play-button');
            playButtons.forEach(button => {
                button.addEventListener('click', function () {
                    const songId = this.getAttribute('data-song-id');
                    const songSrc = this.getAttribute('data-song-src');
                    const songImage = this.getAttribute('data-song-image');
                    const songName = this.getAttribute('data-song-name');
                    const songAuthor = this.getAttribute('data-song-author');
                    playPauseButton.innerHTML = '<i class="fas fa-pause-circle"></i>';

                    // Call getSongDetails with the selected song ID
                    getSongDetails(songId)
                        .then(function (response) {
                            if (response.status === 200) {
                                const songDetails = response.data;
                                console.log('Song Details:', songDetails);

                                // Update footer with song details
                                footerSongImage.src = songImage;
                                footerSongName.textContent = songName;
                                footerSongAuthor.textContent = songAuthor;

                                // Update the audio source and play the song
                                audioPlayer.src = songSrc;
                                audioPlayer.play();


                                // Set the volume to maximum
                                audioPlayer.volume = 1;
                                volumeRange.value = 100;

                                // Update the play/pause button
                                playPauseButton.classList.remove('fa-play-circle');
                                playPauseButton.classList.add('fa-pause-circle');

                                // Set the current song
                                currentSong = {
                                    songId,
                                    songSrc,
                                    songImage,
                                    songName,
                                    songAuthor
                                };
                            } else {
                                alert('Failed to get song details');
                            }
                        })
                        .catch(function (error) {
                            console.error('Error fetching song details:', error);
                        });
                });
            });
        }
        // Initial call to get all songs
        getAllSongs()
            .then(function (response) {
                if (response.status === 200 && response.data.status === 'success') {
                    const songs = response.data.data;
                    console.log('All Songs:', songs);
                    renderSongs(songs);
                } else {
                    alert(response.data.message || 'No songs found');
                }
            })
            .catch(function (error) {
                console.error('Error fetching songs:', error);
            });

        // Play/pause button functionality
        playPauseButton.addEventListener('click', function () {
            if (audioPlayer.paused) {
                audioPlayer.play();
                playPauseButton.classList.remove('fa-play-circle');
                playPauseButton.classList.add('fa-pause-circle');
            } else {
                audioPlayer.pause();
                playPauseButton.classList.remove('fa-pause-circle');
                playPauseButton.classList.add('fa-play-circle');
            }
        });

        // Update the play/pause button when the song ends
        audioPlayer.addEventListener('ended', function () {
            playPauseButton.classList.remove('fa-pause-circle');
            playPauseButton.classList.add('fa-play-circle');
        });

        // Update current time and total time
        audioPlayer.addEventListener('timeupdate', function () {
            currentTimeElement.textContent = formatTime(audioPlayer.currentTime);
            timeSlider.value = (audioPlayer.currentTime / audioPlayer.duration) * 100;
        });

        // Set total time when metadata is loaded
        audioPlayer.addEventListener('loadedmetadata', function () {
            totalTimeElement.textContent = formatTime(audioPlayer.duration);
        });

        // Seek functionality
        timeSlider.addEventListener('input', function () {
            const seekTime = (timeSlider.value / 100) * audioPlayer.duration;
            audioPlayer.currentTime = seekTime;
        });

        // Volume control functionality
        volumeRange.addEventListener('input', function () {
            audioPlayer.volume = volumeRange.value / 100;
        });

        // Set initial volume to max
        audioPlayer.volume = 1;
        volumeRange.value = 100;
    });


    // Get audio element
    var audio = document.getElementById("audio-player");

    // Get play/pause button
    var playPauseButton = document.getElementById("play-pause-button");

    // Play/pause function
    function togglePlayPause() {
        if (audio.paused) {
            audio.play();
            playPauseButton.innerHTML = '<i class="fas fa-pause-circle"></i>';
        } else {
            audio.pause();
            playPauseButton.innerHTML = '<i class="fas fa-play-circle"></i>';
        }
    }

    // Add click event listener to play/pause button
    playPauseButton.addEventListener("click", togglePlayPause);

    // Update current time and total time
    audio.addEventListener("timeupdate", function () {
        var currentTime = document.getElementById("current-time");
        var totalTime = document.getElementById("total-time");
        currentTime.innerHTML = formatTime(audio.currentTime);
        totalTime.innerHTML = formatTime(audio.duration);
    });

    // Function to format time (mm:ss)
    function formatTime(time) {
        var minutes = Math.floor(time / 60);
        var seconds = Math.floor(time % 60);
        return minutes + ":" + (seconds < 10 ? "0" : "") + seconds;
    }

    // Volume control
    var volumeRange = document.getElementById("volumeRange");
    volumeRange.addEventListener("change", function () {
        audio.volume = volumeRange.value / 100;
    });
    // Lấy phần tử thanh trượt thời gian
    var timeSlider = document.getElementById("songTime");

    // Khi bài hát được phát, cập nhật giá trị của thanh trượt thời gian
    audio.addEventListener("timeupdate", function () {
        var currentTime = audio.currentTime;
        var duration = audio.duration;
        var percentage = (currentTime / duration) * 100;
        timeSlider.value = percentage;
    });

    // Khi người dùng di chuyển thanh trượt, điều chỉnh thời gian của bài hát
    timeSlider.addEventListener("input", function () {
        var percentage = timeSlider.value;
        var duration = audio.duration;
        var currentTime = (percentage * duration) / 100;
        audio.currentTime = currentTime;
    });
    // Lấy phần tử thanh trượt thời gian
    var timeSlider = document.getElementById("songTime");

    // Khi bài hát được phát, cập nhật giá trị của thanh trượt thời gian và tạo biến --range-value
    audio.addEventListener("timeupdate", function () {
        var currentTime = audio.currentTime;
        var duration = audio.duration;
        var percentage = (currentTime / duration) * 100;
        timeSlider.value = percentage;
        timeSlider.style.setProperty('--range-value', percentage + '%');
    });
</script>

<script>
    document.getElementById("logout").addEventListener("click", function() {
        var xhr = new XMLHttpRequest();
        xhr.open("GET", "/logout", true);
        xhr.onreadystatechange = function() {
            if (xhr.readyState === 4 && xhr.status === 200) {
                // Đăng xuất thành công, chuyển hướng đến trang đăng nhập
                window.location.href = "/MusicMp3";
            }
        };
        xhr.send();
    });

</script>

<script>
    document.getElementById('submitButton').addEventListener('click', function (e) {
        var nameInput = document.getElementById('nameInput').value;
        if (nameInput.trim() !== "") { // Kiểm tra input có dữ liệu không
            if (/[^a-zA-Z\s]/.test(nameInput)) { // Kiểm tra nếu có ký tự không phải là chữ cái hoặc khoảng trắng
                alert("Chỉ được nhập chữ và khoảng trắng");
                e.preventDefault(); // Ngăn chặn hành động mặc định của nút "Submit"
            }
        }
    });
</script>
<script>
    document.getElementById('submitButton').addEventListener('click', function (e) {
        var phoneInput = document.getElementById('phoneInput').value;
        if (phoneInput.trim() !== "") { // Kiểm tra input có dữ liệu không
            if (!/^\d{10}$/.test(phoneInput)) { // Kiểm tra nếu không phải là 10 số
                alert("Chỉ được nhập 10 số và không được nhập chữ");
                e.preventDefault(); // Ngăn chặn hành động mặc định của nút "Submit"
            }
        }
    });
</script>

</body>

</html>